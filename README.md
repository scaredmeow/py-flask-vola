# Vola - Backend

Vola backend implemented with Flask and Supabase backend.

## Objective

To create a sport social media for athletes in the Philippines.

## Project Structure

    ├── /.vscode                  <- Source folder containing vscode configurations.
    ├── /migrations               <- Source folder containing the alembic migrations.
    ├── /mock_data                <- mock data
    ├── /src                      <- source folder for the flask app.
    ├── /tests                    <- source folder for tests file.
    ├── .dockerignore             <- Files to be ignored by docker.
    ├── .gitignore                <- Files to be ignored by git.
    ├── .python-version           <- Pinned python version for the project.
    ├── Dockerfile                <- Docker image configuration.
    ├── pyproject.toml            <- The project configuration, e.g. generated by 'rye init'
    ├── README.md                 <- The top-level README for developers/collaborators using this project.
    ├── requirements-dev.lock     <- The lockfile used in this project for local development. Auto Generated by Rye
    └── requirements.lock         <- The lockfile used in this project, e.g. generated by 'rye sync'

## Tech Stack Used

![Python](https://img.shields.io/badge/-Python%203-%232c3e50?style=for-the-badge&logo=Python)
![Flask](https://img.shields.io/badge/-Flask-%232c3e50?style=for-the-badge&logo=Flask)
![SQLAlchemy](https://img.shields.io/badge/-SQLAlchemy-%232c3e50?style=for-the-badge&logo=SQLAlchemy)
![PostgreSQL](https://img.shields.io/badge/-PostgreSQL-%232c3e50?style=for-the-badge&logo=PostgreSQL)
![Supabase](https://img.shields.io/badge/-Supabase-%232c3e50?style=for-the-badge&logo=Supabase)
![Docker](https://img.shields.io/badge/-Docker-%232c3e50?style=for-the-badge&logo=Docker)

## Prerequisites

- [Python 3.12.2](https://www.python.org/downloads/release/python-3122) <!-- Specify the python version you are using, [Python 3.9.5](https://www.python.org/downloads/release/python-395/) is recommended. -->
- [GIT](https://git-scm.com/downloads)
- [Rye](rye-up.com) or [Hatch](hatch.pypa.io/latest/intro) for managing [`pyproject.toml`](pyproject.toml)
- Package Lockfile in [`requirements.lock`](requirements.lock)
- Dev Lockfile in [`requirements-dev.lock`](requirements-dev.lock)
- [Docker](https://docs.docker.com/get-docker/) <!-- Specify the docker version you are using, [Docker 20.10.7](https://docs.docker.com/engine/release-notes/#20107) is recommended. -->

## Getting Started

Download first [GIT](https://git-scm.com/downloads) in order to use git commands in your local machine.

To get a local copy up and running follow these simple example steps.

```bash
# cd folder/to/clone-into/
# git clone https://github.com/scaredmeow/project-name.git

cd desktop/
git clone https://github.com/OrienteSME/Microservices.git
```

This will download the project to a folder named after the Git repository ("GenAIPoc" in this case). If you want a different folder name, simply specify it as the last parameter:

```bash
# git clone https://github.com/OrienteSME/project-name.git <other-name>

git clone https://github.com/OrienteSME/Microservices.git microservices
```

## Configuring your workspace

1. Open a terminal *(CMD/Bash/Powershell/ZSH/etc)*
2. Check if both python and pip is installed by typing `python --version` and `pip version`. Alternatively if this doesn't work type `python3 --version` and `pip3 --version`.
3. Go to the directory/folder where you clone the project, and open it with your favorite code editor (preferably VS Code).
4. Open a terminal on the same directory of your project and create a virtual environment by typing the following:
    - **Native Python Virtual Environment:**

        ```bash
        # python -m venv <env_name>

        python -m venv venv
        ```

    - **Hatch:**

        ```bash
        hatch env create
        ```

    - **Rye:**

        ```bash
        rye sync
        ```

5. Activate your environment by using the following:
    - **Powershell:**

        ```powershell
        # .\<env_name>\Scripts\activate.ps1

        .\venv\Scripts\activate.ps1
        ```

    - **Bash/ZSH/Fish:**

        ```bash
        # source ./<env_name>/bin/activate

        source ./venv/bin/activate
        ```

    - **Hatch:**

        ```bash
        hatch shell
        ```

6. If you want to add a new package, add it to the `pyproject.toml` file and run the following command:

   ```bash
   pip install pip-tools
   pip-compile pyproject.toml --output-file=requirements.lock --rebuild
   ```

   alternatively, if this doesn't work type

    ```bash
    pip3 install pip-tools
    pip-compile pyproject.toml --output-file=requirements.lock --rebuild
    ```

    alternatively, if you are using Rye you can use the following command:

    ```bash
    rye add <package>
    ```

7. Install the requirements by typing the following:

   ```bash
   pip install -r requirements-dev.lock # for local dev
   ```

   alternatively, if this doesn't work type

    ```bash
    pip3 install -r requirements-dev.lock # for local dev
    ```

    alternatively, If you are using Rye you can use the following command:

    ```bash
    rye sync
    ```

8. Rename the `.env.example` file to `.env` and fill in the necessary environment variables.

9. Rename the `.flaskenv.example` file to `.flaskenv` and fill in the necessary environment variables.

10. Run the application either of the following commands:
    - [General Environments] Run the `flask app` using the following command:

        ```bash
        # flask run --host=<host> -p <port>
        flask run --host=0.0.0.0 -p 5000 # for dev only
        ```

        alternatively, if this doesn't work type

        ```bash
        # flask -A <app_name> run --host=<host> -p <port>
        flask -A app run --host=0.0.0.0 -p 5000 # for dev only
        ```

    - [UNIX Based Environments] Run the bash script `boot.sh` using the following command:

        ```bash
        source boot.sh
        ```

        alternatively, if this doesn't work type

        ```bash
        . boot.sh
        ```

    - [Dockerized Environment] Build and run the Docker image using the following command:

        ```bash
        # Base docker command
        # docker build -t <image_name> .
        # docker run -d -p <host_port>:<container_port> <image_name>
        docker build -t hackathonsph .
        docker run -d -p 5000:5000 hackathonsph

        # If there is a docker-compose file
        docker-compose build
        docker-compose up -d
        ```

    - [Package Manager] Rye or Hatch

        ```bash
        # rye run flask -A <app_name> run --host=<host> -p <port>
        rye run flask -A app run --host=0.0.0.0 -p 5000 # for dev only
        ```

        ```bash
        # hatch run flask -A <app_name> run --host=<host> -p <port>
        hatch run flask -A app run --host=0.0.0.0 -p 5000 # for dev only

        # or enter to hatch shell
        hatch shell
        flask -A app run --host=0.0.0.0 -p 5000 # for dev only
        ```

11. Open your browser and go to `http://localhost:5000/` to see the app running.

## Database Setup

1. Do the steps 1-5 of the [Configuring your workspace](#configuring-your-workspace) section.
2. If you are using a local postgres/sqlite database, skip the following step and continue in [Migration](migrations/README#checking-migrations).
3. If you are using a cloud provisioned database, make sure that you have the following environment variables in your `.env` file:

   ```bash
   # Database URL Sample Connection Link / Ask for the connection link from the team
   DATABASE_URL=postgresql://<username>:<password>@<host>:<port>/<db>
   SQLALCHEMYBINDS={"<bind-name>":"postgresql://<username>:<password>@<host>:<port>/<db>"}
   ```

4. Run a remote ssh connection to the server where the database is hosted through the following commands.
    - For MAC/Linux/Unix based environments:

        ```bash
        ssh <username>@<host>
        ```

    - For Windows based environments, Install a [Gitbash](https://git-scm.com/downloads) or [Putty](https://www.putty.org/) client:

        ```bash
        # If you are using Gitbash
        ssh <username>@<host>
        ```

5. Once you are connected to the server you may proceed to [Migration](migrations/README#checking-migrations).

## Coding Standards

We follow the [PEP 8](https://www.python.org/dev/peps/pep-0008/) style guide for Python code formatting and naming conventions. We also use [black](https://github.com/psf/black) as our code formatter and [flake8](https://flake8.pycqa.org/en/latest/) as our code linter.

Please make sure your code is formatted and linted before submitting a pull request. You can use the following commands to do so:

```bash
# Install first pre-commit
pre-commit install

# Check the files using pre-commit
pre-commit run --all
```

Alternatively you can use rye or hatch to format and lint your code:

```bash
# Rye
rye fmt
rye lint

# Hatch
hatch fmt
```

We also use [docstrings](https://www.python.org/dev/peps/pep-0257/) to document our code and functions. We follow the [Google style](https://sphinxcontrib-napoleon.readthedocs.io/en/latest/example_google.html) for docstrings.

Please make sure your code is documented before submitting a pull request. You can use the following command to check your docstrings:

```bash
# Check docstrings with pydocstyle
pydocstyle .
```

[Optional] Static type checking is also encouraged. We use [mypy](https://mypy.readthedocs.io/en/stable/) for static type checking.

Please make sure your code is type checked before submitting a pull request. You can use the following command to check your types:

```bash
# Check types with mypy
mypy .
```

## Testing

We use [pytest](https://docs.pytest.org/en/stable/) as our testing framework for Python code. We write unit tests for our functions and classes, as well as integration tests for our scripts and notebooks.

Please make sure your code is tested before submitting a pull request. You can use the following command to run the tests:

```bash
# Run tests with pytest
pytest .
```

Rye and Hatch also have built-in testing commands that you can use:

```bash
# Rye
rye test

# Hatch
hatch run test
```

## Contributing Guidelines

To contribute to the repository through Issues or Pull Requests, see [`CONTRIBUTING.md`](CONTRIBUTING.md).

<!-- Fix this base on your contact details -->

## Contact

<a href="https://twitter.com/intent/follow?screen_name=scaredmeow_&tw_p=followbutton">
  <img src="https://img.shields.io/twitter/follow/scaredmeow_?label=Twitter&style=social" alt="github">
</a>
<a href="https://www.linkedin.com/in/neilriego/">
  <img src="https://img.shields.io/badge/- -%232c3e50?label=LinkedIn&style=social&logo=linkedin" alt="linkedin">
</a>
<a href="mailto:neilchristianriego3@gmail.com">
  <img src="https://img.shields.io/badge/- -%232c3e50?label=Email&style=social&logo=gmail" alt="gmail">
</a>
<a href="https://calendly.com/neilriego/book-a-meeting">
  <img src="https://img.shields.io/badge/- -%232c3e50?label=Book a Meeting with Me&style=social&logo=Google Calendar" alt="Calendly">
</a>
